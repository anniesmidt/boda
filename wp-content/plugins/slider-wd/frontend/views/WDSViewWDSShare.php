<?php

class WDSViewWDSShare {
  ////////////////////////////////////////////////////////////////////////////////////////
  // Events                                                                             //
  ////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////
  // Constants                                                                          //
  ////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////
  // Variables                                                                          //
  ////////////////////////////////////////////////////////////////////////////////////////
  private $model;
  ////////////////////////////////////////////////////////////////////////////////////////
  // Constructor & Destructor                                                           //
  ////////////////////////////////////////////////////////////////////////////////////////
  public function __construct($model) {
    $this->model = $model;
  }
  ////////////////////////////////////////////////////////////////////////////////////////
  // Public Methods                                                                     //
  ////////////////////////////////////////////////////////////////////////////////////////
  public function display() {
    $current_url = (isset($_GET['curr_url']) ? $_GET['curr_url'] : '');
    if (isset($_GET['image_id'])) {
      $image_id = esc_html($_GET['image_id']);
      $cur_image_row = $this->model->get_slide_row_data($image_id);
      $cur_image_url = ($cur_image_row->type == "YOUTUBE" || $cur_image_row->type == "VIMEO") ? $cur_image_row->thumb_url : str_replace(' ', '%20', $cur_image_row->image_url);
      ?>
      <html>
        <head>
          <meta property="og:image" name="bwg_image" content="<?php echo $cur_image_url; ?>" />
          <meta property="og:title" name="bwg_title" content="<?php echo $cur_image_row->title; ?>" />
        </head>
        <body style="display: none;">
          <img src="<?php echo $cur_image_url; ?>" />
        </body>
      </html>
      <?php
      if ($current_url) {
        $current_url = add_query_arg(array('image_id' => $image_id, 'curr_url' => $current_url), $current_url);
      }
    }
    ?>
    <script>
      window.location.href = "<?php echo $current_url; ?>";
    </script>
    <?php
    die();
  }
  
  ////////////////////////////////////////////////////////////////////////////////////////
  // Getters & Setters                                                                  //
  ////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////
  // Private Methods                                                                    //
  ////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////
  // Listeners                                                                          //
  ////////////////////////////////////////////////////////////////////////////////////////
}